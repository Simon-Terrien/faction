name: Faction CD Workflow

on: [push]

jobs:
  build-and-package:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
      with:
        ref: 'artifacts' # Specify the branch you want to push artifacts to
      name: Check out the repository code
    
    - name: Set up JDK 17
      uses: actions/setup-java@v2
      with:
        java-version: '17'
        distribution: 'adopt'
    
    - name: Clean and Compile the project
      run: mvn clean compile
    
    - name: Package WAR file
      run: mvn war:war
    
    - name: Configure Git
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
    
    - name: Commit WAR file
      run: |
        git add ./target/*.war
        git commit -m "Add WAR file - $(date)"
    
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: 'artifacts' # Specify the same branch here
